time_count = time_count + 1
}
res.ev[j, 1:(p+1)] = c(ev, j)
end_ev = Sys.time()
cat(paste0("Finish repetition: "))
print(end_ev - start_ev)
}
ev_all[1:num_ev, 1:(p+1), k] = as.matrix(res.ev)
vif_all[1:(num_ev*num_rep), 1:(p+2), k] = as.matrix(res.vif)
bias.long_GDA = resArr2Long(res.ordered_bias_GDA, p, NULL,"bias", "GDA")
bias.long_CorPA = resArr2Long(res.ordered_bias_CorPA, p, NULL, "bias", "CorPA")
bias.long_RegPA = resArr2Long(res.ordered_bias_RegPA, p, NULL, "bias", "RegPA")
bias.long_IdA = resArr2Long(res.ordered_bias_IdA, p, NULL, "bias", "IdA")
bias.long_all = rbind(bias.long_GDA, bias.long_IdA, bias.long_RegPA, bias.long_CorPA)
bias.long_all = bias.long_all %>%
mutate(
variable = factor(variable, levels = 1:p),
Z = factor(Z, levels = c("Johnson", "GS", "PC", "VM")),
Method = factor(Method, levels = c("GDA", "CorPA", "RegPA", "IdA")),
ev1.p = ev_all[ev_index, 1, p - p_min + 1] / p,
vif1 = vif_all[(ev_index - 1) * num_rep + seed, 1, p - p_min + 1],
kappa = ev_all[ev_index, 1, p - p_min + 1] / ev_all[ev_index, p, p - p_min + 1]
)
rmse.long_all_mean = bias.long_all %>%
group_by(idy, ev_index, seed, Z, Method, ev1.p, vif1, kappa) %>%
summarize(rmse = sqrt(mse(value)), .groups = "drop") %>%
group_by(ev_index, seed, Z, Method, ev1.p, vif1, kappa) %>%
summarize(rmse_mean = mean(rmse), .groups = "drop") %>%
mutate(var = factor(p, levels = 3:10)) %>%
as.data.frame()
bias.long.J_mean = bias.long_all %>%
filter(Z == "Johnson", Method %in% c("GDA", "CorPA", "RegPA", "IdA")) %>%
group_by(ev_index, seed, variable, Z, Method, ev1.p, vif1, kappa) %>%
summarize(value = mean(value), .groups = "drop") %>%
mutate(num_p = p)%>%
as.data.frame()
saveRDS(rmse.long_all_mean, paste0("mean_rmse_p", p, ".rds"), compress = FALSE)
saveRDS(bias.long.J_mean, paste0("mean_bias_p", p, ".rds"), compress = FALSE)
rm(bias.long_GDA, bias.long_CorPA, bias.long_RegPA, bias.long_IdA, bias.long_all)
end_p = Sys.time()
cat(paste0("Finish p = ", p, " : "))
print(end_p - start_p)
}
for(i in 1:4){
res.tau_GDA[, p - p_min + 2, i] = res.ordered_bias_GDA[, p+1, 1]
res.tau_GDA[, p - p_min + 3, i] = res.ordered_bias_GDA[, p+2, 1]
res.tau_GDA[, p - p_min + 4, i] = res.ordered_bias_GDA[, p+3, 1]
res.tau_CorPA[, p - p_min + 2, i] = res.ordered_bias_GDA[, p+1, 1]
res.tau_CorPA[, p - p_min + 3, i] = res.ordered_bias_GDA[, p+2, 1]
res.tau_CorPA[, p - p_min + 4, i] = res.ordered_bias_GDA[, p+3, 1]
res.tau_RegPA[, p - p_min + 2, i] = res.ordered_bias_GDA[, p+1, 1]
res.tau_RegPA[, p - p_min + 3, i] = res.ordered_bias_GDA[, p+2, 1]
res.tau_RegPA[, p - p_min + 4, i] = res.ordered_bias_GDA[, p+3, 1]
res.tau_IdA[, p - p_min + 2, i] = res.ordered_bias_GDA[, p+1, 1]
res.tau_IdA[, p - p_min + 3, i] = res.ordered_bias_GDA[, p+2, 1]
res.tau_IdA[, p - p_min + 4, i] = res.ordered_bias_GDA[, p+3, 1]
}
tau.long_GDA = resArr2Long(res.tau_GDA, p, p_min, "tau", "GDA")
tau.long_CorPA = resArr2Long(res.tau_CorPA, p, p_min, "tau", "CorPA")
tau.long_RegPA = resArr2Long(res.tau_RegPA, p, p_min, "tau", "RegPA")
tau.long_IdA = resArr2Long(res.tau_IdA, p, p_min, "tau", "IdA")
tau.long_all = rbind(tau.long_GDA, tau.long_IdA, tau.long_RegPA, tau.long_CorPA)
saveRDS(tau.long_all, paste0("Ktau_pm", p_min, "_pM", p_max, ".rds"), compress = TRUE)
saveRDS(ev_all, paste0("ev_all_", p_min, "_", p_max, ".rds"), compress = FALSE)
saveRDS(vif_all, paste0("vif_all_", p_min, "_", p_max, ".rds"), compress = FALSE)
end_total = Sys.time()
print(end_total - start_total) # 2.2 days
}
################################
# folder_name = "res"
# dir.create("res")
# setwd(paste0("./", folder_name))
folder_name = "Rtmp"
dir.create("C:/Rtmp")
setwd(paste0("C:/Rtmp"))
num_rep = 10
num_y = 100
# small
p_min = 3
p_max = 6
num_ev_s = 1000
sim.master(p_min=p_min, p_max=p_max, num_ev=num_ev_s, num_rep=num_rep, num_y=num_y)
# large - 1
p_min = 7
p_max = 9
num_ev_l = 2500
sim.master(p_min=p_min, p_max=p_max, num_ev=num_ev_l, num_rep=num_rep, num_y=num_y)
tau.long_all_3_6 = readRDS(paste0("Ktau_pm", 3, "_pM", 6, ".rds"))
tau.long_all_7_9 = readRDS(paste0("Ktau_pm", 7, "_pM", 9, ".rds"))
tau.long_all_10_10 = readRDS(paste0("Ktau_pm", 10, "_pM", 10, ".rds"))
tau.long_all = rbind(tau.long_all_3_6, tau.long_all_7_9, tau.long_all_10_10)
saveRDS(tau.long_all, paste0("Ktau_pM", 10, ".rds"))
ev_all = array(NA, dim = c(num_ev_l, 11, 8))
ev_all_3_6 = readRDS(paste0("ev_all_", 3, "_", 6, ".rds"))
ev_all_7_9 = readRDS(paste0("ev_all_", 7, "_", 9, ".rds"))
ev_all_10_10 = readRDS(paste0("ev_all_", 10, "_", 10, ".rds"))
ev_all[1:num_ev_s, 1:7, 1:4] = ev_all_3_6
ev_all[1:num_ev_l, 1:10, 5:7] = ev_all_7_9
ev_all[1:num_ev_l, 1:11, 8:8] = ev_all_10_10
saveRDS(ev_all, paste0("ev_all.rds"))
vif_all = array(NA, dim = c(num_ev_l * num_rep, 12, 8))
vif_all_3_6 = readRDS(paste0("vif_all_", 3, "_", 6, ".rds"))
vif_all_7_9 = readRDS(paste0("vif_all_", 7, "_", 9, ".rds"))
vif_all_10_10 = readRDS(paste0("vif_all_", 10, "_", 10, ".rds"))
vif_all[1:(num_ev_s * num_rep), 1:8, 1:4] = vif_all_3_6
vif_all[1:(num_ev_l * num_rep), 1:11, 5:7] = vif_all_7_9
vif_all[1:(num_ev_l * num_rep), 1:12, 8:8] = vif_all_10_10
saveRDS(vif_all, paste0("vif_all.rds"))
################################
ev_all = readRDS(paste0("ev_all.rds"))
vif_all = readRDS(paste0("vif_all.rds"))
p_min = 3
p_max = 10
tau.long_all = readRDS(paste0("Ktau_pM", 10, ".rds"))
tau.long_all_mean.temp <- tau.long_all %>%
group_by(variable, Z, Method, ev_index, seed) %>%
summarize(Ktau_mean = mean(value), .groups = "drop")
tau.long_all_mean = data.frame()
for(i in 1:length(p_min:p_max)){
p = (p_min:p_max)[i]
print(p)
tau.long_all_mean.p <- tau.long_all_mean.temp %>%
filter(variable == as.character(p)) %>%
mutate(
ev1.p = ev_all[ev_index, 1, p - p_min + 1] / p,
vif1 = vif_all[(ev_index - 1) * num_rep + seed, 1, p - p_min + 1],
kappa = ev_all[ev_index, 1, p - p_min + 1] / ev_all[ev_index, p, p - p_min + 1]
) %>%
as.data.frame()
tau.long_all_mean = rbind(tau.long_all_mean, tau.long_all_mean.p)
}
saveRDS(tau.long_all_mean, paste0("mean_Ktau_pM", p_max, ".rds"))
rm(list = ls())
library(ggplot2)
library(ggpattern)
library(reshape2)
library(patchwork)
library(dplyr)
library(scales)
library(tidyverse)
library(latex2exp)
source("utils_plot.R")
setwd("G:/其他電腦/我的筆記型電腦/PhD/Journal Paper/JWR/codes/ORMs")
rm(list = ls())
library(ggplot2)
library(ggpattern)
library(reshape2)
library(patchwork)
library(dplyr)
library(scales)
library(tidyverse)
library(latex2exp)
source("utils_plot.R")
p_min = 3
p_max = 10
p_set = c(3:10)
num_ev_set = c(rep(1000, 4), rep(2500, 4))
num_rep = 10
num_y = 100
res_folder_name = "res"
fig_folder_name = "fig"
dir.create(fig_folder_name)
scenario_set = c("1.1", "1.2", "2.1", "2.2")
ev_all = readRDS(paste0(res_folder_name, "//ev_all.rds"))
vif_all = readRDS(paste0(res_folder_name, "//vif_all.rds"))
tau.long_all_mean_raw = readRDS(paste0(res_folder_name, "//mean_Ktau_pM", p_max,".rds")) %>%
mutate(
variable = factor(variable, levels = 3:p_max),
Z = factor(Z, levels = c("Johnson", "GS", "PC", "VM")),
Method = factor(Method, levels = c("GDA", "CorPA", "RegPA", "IdA")),
)
# w/o filtering
rmse.long_all_mean = data.frame()
tau.long_all_mean = data.frame()
for (i in 1:length(p_set)) {
p = p_set[i]
print(p)
num_ev = num_ev_set[p-p_min+1]
rmse.long_all_mean.p = readRDS(paste0(res_folder_name, "//mean_rmse_p", p, ".rds"))
tau.long_all_mean.p = tau.long_all_mean_raw %>%
rename(value = Ktau_mean, var = variable) %>%
filter(var == p)
rmse.long_all_mean = rbind(rmse.long_all_mean, rmse.long_all_mean.p)
tau.long_all_mean = rbind(tau.long_all_mean, tau.long_all_mean.p)
}
rmse.long_all_mean_table <- rmse.long_all_mean %>%
group_by(Method, Z, var) %>%
summarize(value = mean(rmse_mean), .groups = "drop") %>%
pivot_wider(names_from = var, values_from = value) %>%
as.data.frame()
tau.long_all_mean_table <- tau.long_all_mean %>%
group_by(Method, Z, var) %>%
summarize(value = mean(value), .groups = "drop") %>%
pivot_wider(names_from = var, values_from = value) %>%
as.data.frame()
combined <- rmse.long_all_mean_table
combined[, 3:10] <- mapply(
function(a, b) paste(a, "/", b),
round(rmse.long_all_mean_table[, 3:10],2), round(tau.long_all_mean_table[, 3:10],2)
)
colnames(combined) = c("Method", "Z", paste0("p = ", 3:10))
write.csv(combined, paste0(fig_folder_name, "//Table 1.csv"))
# w/ filtering
data_count = matrix(0, 8, 4)
p_rmse_list = p_tau_list = list()
t_ev = 1.5
condition_map <- list(
"1.1" = quote(vif1 <  4 * p & ev1.p <  t_ev / sqrt(p)),
"1.2" = quote(vif1 <  4 * p & ev1.p >= t_ev / sqrt(p)),
"2.1" = quote(vif1 >= 4 * p & ev1.p <  t_ev / sqrt(p)),
"2.2" = quote(vif1 >= 4 * p & ev1.p >= t_ev / sqrt(p))
)
for(j in 1:length(scenario_set)){
s = scenario_set[j]
print(s)
rmse.long_all_mean = data.frame()
tau.long_all_mean = data.frame()
bias.long.J_p3710 = data.frame()
for (i in 1:length(p_set)) {
p = p_set[i]
print(p)
num_ev = num_ev_set[p-p_min+1]
rmse.long_all_mean.p = readRDS(paste0(res_folder_name, "//mean_rmse_p", p, ".rds"))
tau.long_all_mean.p = tau.long_all_mean_raw %>%
rename(value = Ktau_mean, var = variable) %>%
filter(var == p)
bias.long_all_mean.p = readRDS(paste0(res_folder_name, "//mean_bias_p", p, ".rds"))
if (s %in% names(condition_map)) {
condition <- condition_map[[s]]
filtered_data <- apply_filters(list(rmse.long_all_mean.p, tau.long_all_mean.p, bias.long_all_mean.p), condition)
rmse.long_all_mean.p <- filtered_data[[1]]
tau.long_all_mean.p <- filtered_data[[2]]
bias.long_all_mean.p <- filtered_data[[3]]
}
rmse.long_all_mean = rbind(rmse.long_all_mean, rmse.long_all_mean.p)
tau.long_all_mean = rbind(tau.long_all_mean, tau.long_all_mean.p)
data_count[i, j] = dim(rmse.long_all_mean.p)[1]
if(p %in% c(4, 7, 10)){
bias.long.J_p3710 = rbind(bias.long.J_p3710, bias.long_all_mean.p)
}
}
rmse.long.J_mean = rmse.long_all_mean %>%
rename(value = rmse_mean) %>%
filter(Z == "Johnson") %>%
mutate(var = factor(var))
p_rmse_z.J_all.reA = plot_Metric_Z.J_All.reA(rmse.long.J_mean, "RMSE", T)
tau.long.J_mean = tau.long_all_mean %>%
filter(Z == "Johnson") %>%
mutate(var = factor(var))
p_tau_z.J_all.reA = plot_Metric_Z.J_All.reA(tau.long.J_mean, "Kendall's tau")
p_bias_Z.J_All.reA_wrap_1 = plot_bias_Z.J_All.reA_wrap(bias.long.J_p3710, "bias")
if(s=="1.2"){
ggsave(paste0(fig_folder_name, "//fig_6.pdf"),
plot = p_bias_Z.J_All.reA_wrap_1, width = 12, height = 8, dpi = 300)
}
p_rmse_list[[s]] = p_rmse_z.J_all.reA
p_tau_list[[s]] = p_tau_z.J_all.reA
}
fig4 = (p_rmse_list$`1.1` + p_tau_list$`1.1`) +
plot_layout(guides = 'collect') +
plot_annotation(tag_levels = 'A')
ggsave(paste0(fig_folder_name, "//fig_4.pdf"),
plot = fig4, width = 12, height = 5, dpi = 300)
fig5 = (p_rmse_list$`1.2` + p_tau_list$`1.2`) +
plot_layout(guides = 'collect') +
plot_annotation(tag_levels = 'A')
ggsave(paste0(fig_folder_name, "//fig_5.pdf"),
plot = fig5, width = 12, height = 5, dpi = 300)
fig8 = (p_rmse_list$`2.1` + p_tau_list$`2.1`) +
plot_layout(guides = 'collect') +
plot_annotation(tag_levels = 'A')
ggsave(paste0(fig_folder_name, "//fig_8.pdf"),
plot = fig8, width = 12, height = 5, dpi = 300)
fig9 = (p_rmse_list$`2.2` + p_tau_list$`2.2`) +
plot_layout(guides = 'collect') +
plot_annotation(tag_levels = 'A')
ggsave(paste0(fig_folder_name, "//fig_9.pdf"),
plot = fig9, width = 12, height = 5, dpi = 300)
#####
# Figure 7
# win-loss analysis
# RMSE
all_plot_data <- list()
p_set = c(4,7,10)
for (p in p_set) {
print(p)
num_ev = num_ev_set[p-p_min+1]
threshold = 4 * p
rmse.long.J_sub_mean = readRDS(paste0(res_folder_name, "//mean_rmse_p", p, ".rds")) %>%
filter(Z == "Johnson", vif1 < threshold) %>%
mutate(
ev1.sqp = ev1.p * sqrt(p)
)
res = rmse.long.J_sub_mean %>%
filter(Method %in% c("CorPA", "RegPA")) %>%
pivot_wider(names_from = Method, values_from = rmse_mean) %>%
rename(mRMSE.RW = CorPA, mRMSE.GCD = RegPA)
res.WinLoss = res  %>%
group_by(ev_index, ev1.p, ev1.sqp) %>%
summarise(WinLoss = test_relation(mRMSE.RW, mRMSE.GCD), .groups = "drop") %>%
mutate(
ev1.p_bin = cut(ev1.p, breaks = seq(0, 1, by = 0.1), include.lowest = TRUE),
ev1.sqp_bin = cut(ev1.sqp, breaks = seq(0.6, 2.1, by = 0.3), include.lowest = TRUE),
WinLoss = recode(WinLoss, "greater" = "GCD wins", "tie" = "tie", "smaller" = "RW wins"),
WinLoss = factor(WinLoss, levels = c("GCD wins", "tie", "RW wins"))
)
summary_data = res.WinLoss %>%
group_by(ev1.sqp_bin) %>%
count(WinLoss) %>%
mutate(
proportion = n / sum(n),
position = 1 - cumsum(proportion) + proportion / 2,
p = as.factor(p) # Add p to data
) %>%
ungroup()
all_plot_data[[p]] = summary_data
}
all_plot_data_rmse = bind_rows(all_plot_data)
levels(all_plot_data_rmse$p) = paste0("p = ", p_set)
###################################################
### K-tau
all_plot_data <- list()
tau.long_all_mean = readRDS(paste0(res_folder_name, "//mean_Ktau_pM", p_max, ".rds"))
for (p in p_set) {
print(p)
num_ev = num_ev_set[p-p_min+1]
threshold = 4 * p
ktau.long.J_sub_mean <- tau.long_all_mean %>%
filter(Z == "Johnson", variable == p, vif1 < threshold) %>%
mutate(
ev1.sqp = ev1.p * sqrt(p)
)
res = ktau.long.J_sub_mean %>%
filter(Method %in% c("CorPA", "RegPA")) %>%
pivot_wider(names_from = Method, values_from = Ktau_mean) %>%
rename(mKtau.RW = CorPA, mKtau.GCD = RegPA)
res.WinLoss = res  %>%
group_by(ev_index, ev1.p, ev1.sqp) %>%
summarise(WinLoss = test_relation(mKtau.RW, mKtau.GCD), .groups = "drop") %>%
mutate(
ev1.p_bin = cut(ev1.p, breaks = seq(0, 1, by = 0.1), include.lowest = TRUE),
ev1.sqp_bin = cut(ev1.sqp, breaks = seq(0.6, 2.1, by = 0.3), include.lowest = TRUE),
WinLoss = recode(WinLoss, "greater" = "RW wins", "tie" = "tie", "smaller" = "GCD wins"),
WinLoss = factor(WinLoss, levels = c("GCD wins", "tie", "RW wins"))
)
summary_data = res.WinLoss %>%
group_by(ev1.sqp_bin) %>%
count(WinLoss) %>%
mutate(
proportion = n / sum(n),
position = 1 - cumsum(proportion) + proportion / 2,
p = as.factor(p) # Add p to data
) %>%
ungroup()
all_plot_data[[p]] = summary_data
}
all_plot_data_ktau = bind_rows(all_plot_data)
levels(all_plot_data_ktau$p) = paste0("p = ", p_set)
all_plot_data_rmse$metric = "rmse"
all_plot_data_ktau$metric = "ktau"
all_plot_data = rbind(all_plot_data_rmse, all_plot_data_ktau)
all_plot_data$metric = factor(all_plot_data$metric, levels = c("rmse", "ktau"))
all_plot_data = all_plot_data[!is.na(all_plot_data$ev1.sqp_bin), ]
levels(all_plot_data$metric) = c("RMSE", "Kendall's tau")
# round(proportion * 100)
fig7 = ggplot(all_plot_data, aes(x = ev1.sqp_bin, y = proportion, fill = WinLoss)) +
geom_bar(stat = "identity", position = "stack") +
geom_text(
aes(y = position, label = ifelse(proportion >= 0.05, round(proportion * 100), "")),
color = "white",
size = 3
) +
labs(
title = "",
x = TeX("\\textbf{Interval for} $\\lambda_1/\\sqrt{p}$"),
y = "Proportion",
fill = "Result"
) +
scale_fill_manual(
values = c("GCD wins" = "#4C72B0", "tie" = "#999999", "RW wins" = "#C44E52"),
limits = c("GCD wins", "tie", "RW wins")
) +
geom_vline(xintercept = 3.5, linetype = "dashed", color = "black") +  # Add the dashed vertical line
facet_grid(rows = vars(p), cols = vars(metric)) +
theme_bw() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, face = "bold"),
axis.title = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12),
legend.text = element_text(size = 10),
strip.text = element_text(size = 10, face = "bold"),
legend.background = element_rect(color = "black")
)
fig7
ggsave(paste0(fig_folder_name, "//fig_7.pdf"),
plot = fig7, width = 12, height = 8, dpi = 300)
# Figure 10
# win-loss analysis
# RMSE
all_plot_data <- list()
p_set = c(4,7,10)
for (p in p_set) {
print(p)
num_ev = num_ev_set[p-p_min+1]
threshold = 4 * p
rmse.long.J_sub_mean = readRDS(paste0(res_folder_name, "//mean_rmse_p", p, ".rds")) %>%
filter(Z == "Johnson", vif1 >= threshold) %>%
mutate(
ev1.sqp = ev1.p * sqrt(p)
)
res = rmse.long.J_sub_mean %>%
filter(Method %in% c("CorPA", "RegPA")) %>%
pivot_wider(names_from = Method, values_from = rmse_mean) %>%
rename(mRMSE.RW = CorPA, mRMSE.GCD = RegPA)
res.WinLoss = res  %>%
group_by(ev_index, ev1.p, ev1.sqp) %>%
summarise(WinLoss = test_relation(mRMSE.RW, mRMSE.GCD), .groups = "drop") %>%
mutate(
ev1.p_bin = cut(ev1.p, breaks = seq(0, 1, by = 0.1), include.lowest = TRUE),
ev1.sqp_bin = cut(ev1.sqp, breaks = seq(0.6, 2.1, by = 0.3), include.lowest = TRUE),
WinLoss = recode(WinLoss, "greater" = "GCD wins", "tie" = "tie", "smaller" = "RW wins"),
WinLoss = factor(WinLoss, levels = c("GCD wins", "tie", "RW wins"))
)
summary_data = res.WinLoss %>%
group_by(ev1.sqp_bin) %>%
count(WinLoss) %>%
mutate(
proportion = n / sum(n),
position = 1 - cumsum(proportion) + proportion / 2,
p = as.factor(p) # Add p to data
) %>%
ungroup()
all_plot_data[[p]] = summary_data
}
all_plot_data_rmse = bind_rows(all_plot_data)
levels(all_plot_data_rmse$p) = paste0("p = ", p_set)
###################################################
### K-tau
all_plot_data <- list()
tau.long_all_mean = readRDS(paste0(res_folder_name, "//mean_Ktau_pM", p_max, ".rds"))
for (p in p_set) {
print(p)
num_ev = num_ev_set[p-p_min+1]
threshold = 4 * p
ktau.long.J_sub_mean <- tau.long_all_mean %>%
filter(Z == "Johnson", variable == p, vif1 >= threshold) %>%
mutate(
ev1.sqp = ev1.p * sqrt(p)
)
res = ktau.long.J_sub_mean %>%
filter(Method %in% c("CorPA", "RegPA")) %>%
pivot_wider(names_from = Method, values_from = Ktau_mean) %>%
rename(mKtau.RW = CorPA, mKtau.GCD = RegPA)
res.WinLoss = res  %>%
group_by(ev_index, ev1.p, ev1.sqp) %>%
summarise(WinLoss = test_relation(mKtau.RW, mKtau.GCD), .groups = "drop") %>%
mutate(
ev1.p_bin = cut(ev1.p, breaks = seq(0, 1, by = 0.1), include.lowest = TRUE),
ev1.sqp_bin = cut(ev1.sqp, breaks = seq(0.6, 2.1, by = 0.3), include.lowest = TRUE),
WinLoss = recode(WinLoss, "greater" = "RW wins", "tie" = "tie", "smaller" = "GCD wins"),
WinLoss = factor(WinLoss, levels = c("GCD wins", "tie", "RW wins"))
)
summary_data = res.WinLoss %>%
group_by(ev1.sqp_bin) %>%
count(WinLoss) %>%
mutate(
proportion = n / sum(n),
position = 1 - cumsum(proportion) + proportion / 2,
p = as.factor(p) # Add p to data
) %>%
ungroup()
all_plot_data[[p]] = summary_data
}
all_plot_data_ktau = bind_rows(all_plot_data)
levels(all_plot_data_ktau$p) = paste0("p = ", p_set)
all_plot_data_rmse$metric = "rmse"
all_plot_data_ktau$metric = "ktau"
all_plot_data = rbind(all_plot_data_rmse, all_plot_data_ktau)
all_plot_data$metric = factor(all_plot_data$metric, levels = c("rmse", "ktau"))
all_plot_data = all_plot_data[!is.na(all_plot_data$ev1.sqp_bin), ]
levels(all_plot_data$metric) = c("RMSE", "Kendall's tau")
fig10 = ggplot(all_plot_data, aes(x = ev1.sqp_bin, y = proportion, fill = WinLoss)) +
geom_bar(stat = "identity", position = "stack") +
geom_text(
aes(y = position, label = ifelse(proportion >= 0.05, round(proportion * 100), "")),
color = "white",
size = 3
) +
labs(
title = "",
x = TeX("\\textbf{Interval for} $\\lambda_1/\\sqrt{p}$"),
y = "Proportion",
fill = "Result"
) +
scale_fill_manual(
values = c("GCD wins" = "#4C72B0", "tie" = "#999999", "RW wins" = "#C44E52"),
limits = c("GCD wins", "tie", "RW wins")
) +
geom_vline(xintercept = 3.5, linetype = "dashed", color = "black") +  # Add the dashed vertical line
facet_grid(rows = vars(p), cols = vars(metric)) +
theme_bw() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, face = "bold"),
axis.title = element_text(size = 12, face = "bold"),
legend.title = element_text(size = 12),
legend.text = element_text(size = 10),
strip.text = element_text(size = 10, face = "bold"),
legend.background = element_rect(color = "black")
)
fig10
ggsave(paste0(fig_folder_name, "//fig_10.pdf"),
plot = fig10, width = 12, height = 8, dpi = 300)
